var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},Main=function(t){function e(){var e=t.call(this)||this;return e.stageW=750,e.stageH=1334,e.listY=242,e.listWidth=640,e.itemHeight=100,e.itemDis=0,e.itemNumPerPage=7,e.myItemDisList=20,e.scrollView=new egret.ScrollView,e.item_bg_color1=2039331,e.item_bg_color2=2828848,e.item_rankx=40,e.item_rankwidth=50,e.item_rankheight=36,e.item_ranksize=36,e.item_rankcolor=16777215,e.item_rankfont="SimHei",e.item_headx=98,e.item_headwidth=48,e.item_headheight=48,e.item_namex=170,e.item_namewidth=264,e.item_nameheight=36,e.item_namesize=30,e.item_namecolor=16777215,e.item_namefont="SimHei",e.item_scorex=470,e.item_scorewidth=118,e.item_scoreheight=36,e.item_scoresize=36,e.item_scorecolor=16777215,e.item_scorefont="SimHei",wx.onMessage(function(t){console.log("openData:onMessage:data:",t);var i=t.command;e.userinfo=t.userinfo,e.stageW=t.stageW,e.stageH=t.stageH,e.shareTicket=t.shareTicket,e.initBg(),"open"==i?e.shareTicket?e.openGroupCloud():e.openFriendCloud():e.closeCloud()}),e}return __extends(e,t),e.prototype.initBg=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight;this.stageW!=t&&(this.scaleX=t/this.stageW),this.stageH!=e&&(this.scaleY=e/this.stageH),this.listHeight=this.itemHeight*this.itemNumPerPage,this.itemWidth=this.listWidth,this.myItemY=this.listY+this.listHeight+this.myItemDisList},e.prototype.openFriendCloud=function(){var t=this;console.log("openFriendCloud"),wx.getFriendCloudStorage({keyList:["score"],success:function(e){t.initItems(e.data,!0)},fail:function(t){console.log("getFriendCloudStorage:error:",t)},complete:function(){console.log("getFriendCloudStorage:complete:")}})},e.prototype.openGroupCloud=function(){var t=this;console.log("openGroupCloud"),wx.getGroupCloudStorage({shareTicket:this.shareTicket,keyList:["score"],success:function(e){t.initItems(e.data,!1)},fail:function(t){console.log("getFriendCloudStorage:error:",t)},complete:function(){console.log("getFriendCloudStorage:complete:")}})},e.prototype.closeCloud=function(){console.log("closeCloud",this.numChildren);for(var t=0,e=this.numChildren;e>t;t++)this.removeChildAt(0);this.scrollView.removeContent()},e.prototype.initItems=function(t,e){console.log("initItems:",t);var i=new egret.DisplayObjectContainer;this.scrollView.setContent(i),this.scrollView.width=this.listWidth,this.scrollView.height=this.listHeight,this.scrollView.x=(this.stageW-this.scrollView.width)/2,this.addChild(this.scrollView);for(var s,o=null!=this.userinfo.avatarUrl?this.userinfo.avatarUrl:"-1",r=-1,a=[],n=0;n<t.length;n++){var h=t[n];o==h.avatarUrl&&(console.log("myrank:",r),s=h,r=n),null!=h&&null!=h.KVDataList&&null!=h.KVDataList[0]&&a.push(h)}a=a.sort(this.sortfun);for(var n=0;n<a.length;n++){var h=a[n],l=this.addItem(n,h);l.y=n*(this.itemHeight+this.itemDis),i.addChild(l)}this.scrollView.y=this.listY,this.initMyItem(r,s)},e.prototype.sortfun=function(t,e){if(null==t.KVDataList[0]||null==e.KVDataList[0])return-1;var i=parseInt(t.KVDataList[0].value),s=parseInt(e.KVDataList[0].value);return i>s?-1:1},e.prototype.initMyItem=function(t,e){if(null!=e&&null!=this.userinfo&&null!=this.userinfo.avatarUrl){var i={};i.avatarUrl=this.userinfo.avatarUrl,i.nickname=this.userinfo.nickName,i.KVDataList=e.KVDataList;var s=this.addItem(t,i);s.x=(this.stageW-s.width)/2,s.y=this.myItemY,this.addChild(s)}},e.prototype.addItem=function(t,e){var i=this,s=e.KVDataList,o={};if(null==s||0==s.length)o={score:"未上榜"},t=-1;else for(var r=0;r<s.length;r++){var a=s[r];o[a.key]=a.value}var n=new egret.DisplayObjectContainer;n.touchEnabled=!0,n.touchChildren=!1,n.width=this.itemWidth,n.height=this.itemHeight;var h=new egret.Shape;h.graphics.beginFill(t%2==0?this.item_bg_color1:this.item_bg_color2),h.graphics.drawRect(0,0,this.itemWidth,this.itemHeight),h.graphics.endFill(),n.addChild(h);var l=this.item_rankcolor;0==t?l=16714060:1==t?l=16732951:2==t&&(l=16769303);var c=this.createTextField(this.item_rankx,n.height,this.item_rankwidth,this.item_rankheight,l,this.item_rankfont,this.item_ranksize);c.text=-1==t?"":t+1+"",n.addChild(c);var m=new egret.ImageLoader;m.once(egret.Event.COMPLETE,function(t){var e=t.currentTarget,s=new egret.Texture;s._setBitmapData(e.data);var o=i.createBitmap(s,i.item_headx,n.height,i.item_headwidth,i.item_headheight);n.addChild(o)},this),m.load(e.avatarUrl);var d=this.createTextField(this.item_namex,n.height,this.item_namewidth,this.item_nameheight,this.item_namecolor,this.item_namefont,this.item_namesize,"left");d.text=this.checkSpeName(e.nickname),n.addChild(d);var g=this.createTextField(this.item_scorex,n.height,this.item_scorewidth,this.item_scoreheight,this.item_scorecolor,this.item_scorefont,this.item_scoresize,"left");return g.text=o.score,n.addChild(g),n},e.prototype.createTextField=function(t,e,i,s,o,r,a,n,h){void 0===n&&(n="center"),void 0===h&&(h="middle");var l=new egret.TextField;return l.touchEnabled=!1,l.x=t,l.width=i,l.height=s,l.textColor=o,l.fontFamily=r,l.size=a,l.textAlign=n,l.verticalAlign=h,l.y=(e-s)/2,l},e.prototype.createBitmap=function(t,e,i,s,o){var r=new egret.Bitmap(t);return r.touchEnabled=!1,r.x=e,r.width=s,r.height=o,r.y=(i-o)/2,r},e.prototype.checkSpeName=function(t){for(var e="",i=0;i<t.length;){var s=t.charCodeAt(i),o=t.charAt(i);i++,s>=65024&&65039>=s||(e+=o)}return e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main"),window.Main=Main;