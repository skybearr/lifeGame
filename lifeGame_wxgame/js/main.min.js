var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);a.prototype=e.prototype,t.prototype=new a},__awaiter=this&&this.__awaiter||function(t,e,a,n){return new(a||(a=Promise))(function(r,i){function s(t){try{h(n.next(t))}catch(e){i(e)}}function o(t){try{h(n["throw"](t))}catch(e){i(e)}}function h(t){t.done?r(t.value):new a(function(e){e(t.value)}).then(s,o)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function a(t){return function(e){return n([t,e])}}function n(a){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,i&&(s=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[0,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return h.label++,{value:a[1],done:!1};case 5:h.label++,i=a[1],a=[0];continue;case 7:a=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===a[0]||2===a[0])){h=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){h.label=a[1];break}if(6===a[0]&&h.label<s[1]){h.label=s[1],s=a;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(a);break}s[2]&&h.ops.pop(),h.trys.pop();continue}a=e.call(t,h)}catch(n){a=[6,n],i=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var r,i,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},msgGoodsBuyRsp=function(){function t(){this.goods=[]}return t}();__reflect(msgGoodsBuyRsp.prototype,"msgGoodsBuyRsp");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,a){function n(n){e.call(a,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),GameLogic.getInstance().GameStage=this.stage,GameLogic.getInstance().main=this,egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),t=GameLogic.getInstance(),[4,platform.getUserInfo()];case 3:return t.userInfo=e.sent(),console.log("userinfo:",GameLogic.getInstance().userInfo),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return a.sent(),[4,this.loadTheme()];case 2:return a.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return a.sent(),this.stage.removeChild(t),[3,5];case 4:return e=a.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,a){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){GameLogic.getInstance().init()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,a,n){function r(t){e.call(n,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),a.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameCommand=function(t){function e(){var e=t.call(this)||this;return e.bases=[1,2,3,4,5,6,7,8,9],e.diss1=[.2,5,10],e.diss2=[.1,.2,5,10],e}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.sendData=function(t){void 0===t&&(t=!1),t&&(DataBase.debt=Math.floor(1.1*DataBase.debt),DataBase.deposit=Math.floor(1.04*DataBase.deposit));var e=this.getData();GameLogic.getInstance().gameui.initData(e)},e.prototype.sendMarket=function(t){DataBase.events=[],DataBase.marketGoods=[];var e=this.getMarket(t);DataBase.marketGoods=e.goods,GameLogic.getInstance().gameui.initMarket(e)},e.prototype.sendStore=function(){var t=new msgGoodsStoreRsp;t.goods=DataBase.storeGoods,GameLogic.getInstance().gameui.initStore(t)},e.prototype.sendEvent=function(){this.dealOtherEvent();for(var t=DataBase.events,e=0;e<t.length;e++)GameLogic.getInstance().gameui.eventAppear(t[e]);DataBase.events=[]},e.prototype.sendError=function(t){GameLogic.getInstance().gameui.errorRsp(t)},e.prototype.sendOver=function(t){DataBase.gameState=0,0==t&&(DataBase.debt=Math.floor(1.15*DataBase.debt),DataBase.deposit=Math.floor(1.04*DataBase.deposit),DataBase.money=DataBase.money+DataBase.deposit-DataBase.debt+this.getStorePrice(),DataBase.debt=0,DataBase.deposit=0),this.sendData(),GameLogic.getInstance().gameui.over(),0==t&&GameLogic.getInstance().setUserCloudStorage()},e.prototype.getStorePrice=function(){for(var t=0,e=0;e<DataBase.storeGoods.length;e++){var a=DataBase.storeGoods[e];t+=a.dwPrice*a.dwNum}return t},e.prototype.getData=function(){var t=new msgLifeDataRsp;return t.dwMoney=DataBase.money,t.dwDebt=DataBase.debt,t.dwDeposit=DataBase.deposit,t.dwPow=DataBase.pow,t.dwTimes=DataBase.times,t.dwMaxStoreNum=DataBase.maxStoreNum,t.dwFame=DataBase.fame,t},e.prototype.getMarket=function(t){var e=new msgGoodsBuyRsp;e.goods=[];for(var a=4+Math.floor(6*Math.random()),n=this.bases.slice(),r=n.length,i=[],s=0;a>s;s++){var o=Math.floor(Math.random()*r);i.push(n[o]),n.splice(o,1)}i.sort(this.sortfun);for(var s=0;s<i.length;s++){var h=new varGoods,c=i[s],l=GameLogic.getInstance().goods[c];null!=l&&(h.dwID=c,h.strName=l.name,h.dwPrice=this.getPrice(l,t),h.dwNum=0,e.goods.push(h))}return e},e.prototype.dealOtherEvent=function(){var t=Math.random()<.2;if(t){var e=Math.floor(4*Math.random())+1,a=Math.random()<.5?1:2,n=Math.floor(3*Math.random())+1;this.addEvent(e,a,n)}},e.prototype.addEvent=function(t,e,a){var n=100*t+10*e+a,r=GameLogic.getInstance().goods["evt"+n];if(null!=r){var i=2==e,s=r.value;if(5>t)switch(t){case 1:s=1>=s?Math.floor(DataBase.money*s):Math.floor(Math.random()*s/5),DataBase.money=DataBase.money+(i?s:-s),DataBase.money=DataBase.money<=0?0:DataBase.money;break;case 2:s=1>=s?Math.floor(DataBase.money*s):Math.floor(Math.random()*s/5),DataBase.deposit=DataBase.deposit+(i?s:-s),DataBase.deposit=DataBase.deposit<=0?0:DataBase.deposit;break;case 3:DataBase.pow=DataBase.pow+(i?s:-s),DataBase.pow=DataBase.pow<=0?0:DataBase.pow;break;case 4:DataBase.fame=DataBase.fame+(i?s:-s),DataBase.fame=DataBase.fame<=0?0:DataBase.fame}"string"==typeof r?DataBase.events.push(StringUtil.getSwfLangStr(r)):DataBase.events.push(StringUtil.getSwfLangStrVar(r.str,[s]))}},e.prototype.getRandom1=function(){var t=Math.random();if(.1>t){var e=Math.floor(3*Math.random());return this.diss1[e]}return 1},e.prototype.getRandom2=function(){var t=Math.floor(4*Math.random());return this.diss2[t]},e.prototype.getPrice=function(t,e){var a=t.price,n=this.getRandom1(),r=Math.floor(a*n),i=Math.random()<.5,s=Math.floor(r*Math.random()*.2);if(r=i?r+s:r-s,e){var o=Math.random()<.1;if(o){var h=this.getRandom2();r=Math.floor(r*h);var c=Math.floor(3*Math.random())+1,l="evt"+(1>h?0:1)+c;DataBase.events.push(t[l])}}return r},e.prototype.sortfun=function(t,e){return e>t?-1:1},e.prototype.saveAchieve=function(){DataBase.money>DataBase.achives[0]&&(DataBase.achives[0]=DataBase.money),DataBase.deposit>DataBase.achives[1]&&(DataBase.achives[1]=DataBase.deposit),DataBase.debt>DataBase.achives[2]&&(DataBase.achives[2]=DataBase.debt),DataBase.pow<DataBase.achives[3]&&(DataBase.achives[3]=DataBase.pow),DataBase.fame<DataBase.achives[4]&&(DataBase.achives[4]=DataBase.fame),DataBase.fame>DataBase.achives[5]&&(DataBase.achives[5]=DataBase.fame)},e.prototype.getPriceInMarket=function(t){for(var e=DataBase.marketGoods,a=0;a<e.length;a++){var n=e[a];if(t==n.dwID)return n.dwPrice}return null},e.prototype.selectPackage=function(t){DataBase.gamePackage=1},e.prototype.startGame=function(){var t=GameLogic.getInstance().data["config"+DataBase.gamePackage];DataBase.times=1,DataBase.money=t.money,DataBase.debt=t.debt,DataBase.deposit=0,DataBase.pow=t.pow,DataBase.maxStoreNum=100,DataBase.fame=t.fame,DataBase.marketGoods=[],DataBase.storeGoods=[],DataBase.events=[],DataBase.achives=[0,0,0,0,0],DataBase.gameState=1,this.sendData(),this.sendMarket(!1)},e.prototype.passOneDay=function(){return 0!=DataBase.gameState?(DataBase.times++,DataBase.times>=GameLogic.getInstance().data.maxday?void this.sendOver(0):(this.sendMarket(!0),this.sendEvent(),this.sendData(!0),DataBase.pow<=0?void this.sendOver(1):void this.saveAchieve())):void 0},e.prototype.buyGoods=function(t,e){if(0==e)return void this.sendError(ERROR.BUY_ZERO);for(var a=DataBase.marketGoods,n=0;n<a.length;n++){var r=a[n];if(r.dwID==t){var i=r.dwPrice*e;if(i>DataBase.money)return void this.sendError(ERROR.MONEY_NOT_ENOUGH);for(var s=DataBase.storeGoods,o=0,h=void 0,c=0;c<s.length;c++){var l=s[c];l.dwID==t&&(h=c),o+=l.dwNum}if(o+e>DataBase.maxStoreNum)return void this.sendError(ERROR.STORE_NOT_ENOUGH);DataBase.money-=i;var u=s[h];if(null==u)u=new varGoods,u.dwID=t,u.dwPrice=r.dwPrice,u.dwNum=e,u.strName=r.strName,s.push(u);else{var p=u.dwNum+e,d=Math.floor((u.dwPrice*u.dwNum+r.dwPrice*e)/p);u.dwNum=p,u.dwPrice=d,s[h]=u}this.sendData(),this.sendStore();break}}},e.prototype.sellGoods=function(t,e){if(0==e)return void this.sendError(ERROR.SELL_ZERO);var a=this.getPriceInMarket(t);if(null==a)return void this.sendError(ERROR.MARKET_NO_GOOD);for(var n=DataBase.storeGoods,r=0;r<n.length;r++){var i=n[r];if(i.dwID==t){DataBase.money+=a*e,i.dwNum-=e,i.dwNum<=0&&DataBase.storeGoods.splice(r,1),this.sendData(),this.sendStore();break}}},e.prototype.cun=function(t){t>0&&t<=DataBase.money&&(DataBase.deposit+=t,DataBase.money-=t,this.sendData())},e.prototype.qu=function(t){t>0&&t<=DataBase.deposit&&(DataBase.deposit-=t,DataBase.money+=t,this.sendData())},e.prototype.huan=function(t){t>0&&t<=DataBase.money&&t<=DataBase.debt&&(DataBase.debt-=t,DataBase.money-=t,this.sendData())},e.prototype.treat=function(t){if(t>0&&100>t){t+DataBase.pow>100&&(t=100-DataBase.pow);var e=t*GameLogic.getInstance().data.hospital;if(e>=DataBase.money)return void this.sendError(ERROR.MONEY_NOT_ENOUGH);DataBase.money-=e,DataBase.pow+=t,this.sendData()}},e.prototype.charity=function(t){if(t>DataBase.money)return void this.sendError(ERROR.MONEY_NOT_ENOUGH);var e,a=GameLogic.getInstance().data.charity;if(a>t){var n=100*Math.random();2>n?(DataBase.fame+=3,e=0):e=1}else{var r=Math.floor(t/a);DataBase.fame+=r,e=10>r?2:100>r?3:4}this.addEvent(5,1,e),DataBase.money-=t,this.sendData(),this.sendEvent()},e.prototype.buyStore=function(t){var e=GameLogic.getInstance().data.maxstore;if(DataBase.maxStoreNum>=e)return void this.sendError(ERROR.MAX_STORE_NUM);var a=GameLogic.getInstance().data.storeprice;if(a>t)return void console.log("价格低于标准值，请勿作弊");if(DataBase.money<t)return void this.sendError(ERROR.MONEY_NOT_ENOUGH);DataBase.maxStoreNum+=10,DataBase.maxStoreNum>=e&&(DataBase.maxStoreNum=e);var n=Math.floor(Math.random()*a/5);DataBase.money-=t+n,this.sendData(),this.addEvent(5,0,0),this.sendEvent()},e}(egret.EventDispatcher);__reflect(GameCommand.prototype,"GameCommand");var GameLogic=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.init=function(){this.initData(),this.showShareMenu(),this.openStart(),this.checkShareInfo()},e.prototype.openStart=function(){this.main.removeChildren(),this.main.addChild(new StartUI)},e.prototype.initData=function(){null==this.data&&(this.data=RES.getRes("config_json")),null==this.strings&&(this.strings=RES.getRes("strings_json")),null==this.goods&&(this.goods=RES.getRes("goods_json"))},e.prototype.startGame=function(){this.main.removeChildren(),this.main.addChild(new GameUI)},e.prototype.login=function(){var t=window.wx;null!=t&&t.login({success:function(){t.getUserInfo({fail:function(t){t.errMsg.indexOf("auth deny")>-1||t.errMsg.indexOf("auth denied")>-1}})}})},e.prototype.showShareMenu=function(){var t=window.wx;null!=t&&(t.showShareMenu(),this.onShare("rightup=1"))},e.prototype.share=function(t){void 0===t&&(t=null);var e=window.wx;null!=e&&(this.updateShareMenu(!0),e.shareAppMessage({title:"来苏州一起浮生吧啊啊啊啊啊啊啊啊啊啊啊啊",imageUrl:"resource/assets/img/qua_1.png",query:t}))},e.prototype.onShare=function(t){void 0===t&&(t="rightup=1");var e=window.wx;null!=e&&(this.updateShareMenu(!0),console.log("onShare:query:",t),e.onShareAppMessage(function(){return{title:"右上角转发一起来苏州浮生吧",imageUrl:"resource/assets/img/qua_4.png",query:t}}))},e.prototype.updateShareMenu=function(t){var e=window.wx;null!=e&&(console.log("updateShareMenu:",t),e.updateShareMenu({withShareTicket:t,success:function(t){console.log("updateShareMenu:success:",t)},fail:function(t){console.log("updateShareMenu:fail:",t)},complete:function(){console.log("updateShareMenu:complete:")}}))},e.prototype.checkShareInfo=function(){var t=this;console.log("checkShareInfo");var e=window.wx;if(null!=e){var a=e.getLaunchOptionsSync();console.log("info:",a),null!=a&&null!=a.shareTicket&&""!=a.shareTicket&&null!=a.query&&"1"==a.query.grouprank&&e.getShareInfo({shareTicket:a.shareTicket,success:function(e){console.log("getShareInfo:success:",e),t.openFriendRank(!1,a.shareTicket)},fail:function(t){console.log("getShareInfo:fail:",t)},complete:function(){console.log("getShareInfo:complete:")}})}},e.prototype.openRank=function(){},e.prototype.openFriendRank=function(t,e){void 0===e&&(e=""),this.isFriend=t,null==this.rankingListMask&&(this.rankingListMask=new egret.Shape,this.rankingListMask.graphics.beginFill(0,1),this.rankingListMask.graphics.drawRect(0,0,this.GameStage.width,this.GameStage.height),this.rankingListMask.graphics.endFill(),this.rankingListMask.alpha=.8,this.rankingListMask.touchEnabled=!0),this.main.addChild(this.rankingListMask);var a=new egret.BitmapData(window.sharedCanvas);a.$deleteSource=!1;var n=new egret.Texture;n._setBitmapData(a),this.bitmap=new egret.Bitmap(n),this.bitmap.width=this.GameStage.stageWidth,this.bitmap.height=this.GameStage.stageHeight,this.main.addChild(this.bitmap),null==this.btn_rankclose&&(this.btn_rankclose=new eui.Image,this.btn_rankclose.source=RES.getRes("qua_0_png"),this.btn_rankclose.left=20,this.btn_rankclose.bottom=40,this.btn_rankclose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeFriendRank,this)),this.main.addChild(this.btn_rankclose),null==this.btn_grouprank&&(this.btn_grouprank=new eui.Image,this.btn_grouprank.source=RES.getRes(t?"qua_0_png":"qua_1_png"),this.btn_grouprank.right=20,this.btn_grouprank.bottom=40,this.btn_grouprank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openGroupRank,this)),this.main.addChild(this.btn_grouprank),egret.startTick(function(t){return egret.WebGLUtils.deleteWebGLTexture(a.webGLTexture),a.webGLTexture=null,!1},this),console.log("postMessage:",this.userInfo),wx.getOpenDataContext().postMessage({head:t?"friend":"group",userinfo:this.userInfo,shareTicket:e,open:!0})},e.prototype.closeFriendRank=function(){this.bitmap&&this.bitmap.parent&&this.bitmap.parent.removeChild(this.bitmap),this.btn_rankclose&&this.btn_rankclose.parent&&this.btn_rankclose.parent.removeChild(this.btn_rankclose),this.btn_grouprank&&this.btn_grouprank.parent&&this.btn_grouprank.parent.removeChild(this.btn_grouprank),this.rankingListMask&&this.rankingListMask.parent&&this.rankingListMask.parent.removeChild(this.rankingListMask),wx.getOpenDataContext().postMessage({head:"friend",open:!1})},e.prototype.openGroupRank=function(){this.isFriend?this.share("grouprank=1"):this.closeGroupRank()},e.prototype.closeGroupRank=function(){this.closeFriendRank()},e.prototype.setUserCloudStorage=function(){for(var t="",e=0;e<DataBase.achives.length;e++)t+=DataBase.achives[e],e<DataBase.achives.length&&(t+=",");wx.setUserCloudStorage({KVDataList:[{key:"money",value:DataBase.money+""},{key:"fame",value:DataBase.fame+""},{key:"achives",value:t}],success:function(t){console.log("setUserCloudStorage:res:",t)},fail:function(t){console.log("setUserCloudStorage:error:",t)},complete:function(){console.log("setUserCloudStorage:complete:")}})},e.prototype.removeUserCloudStorage=function(t){wx.removeUserCloudStorage()({keyList:t,success:function(t){console.log("removeUserCloudStorage:res:",t)},fail:function(t){console.log("removeUserCloudStorage:error:",t)},complete:function(){console.log("removeUserCloudStorage:complete:")}})},e.prototype.setUserStorage=function(t){},e}(egret.EventDispatcher);__reflect(GameLogic.prototype,"GameLogic");var DataBase=function(){function t(){}return t}();__reflect(DataBase.prototype,"DataBase");var GameConst=function(){function t(){}return t}();__reflect(GameConst.prototype,"GameConst");var ERROR;!function(t){t[t.MONEY_NOT_ENOUGH=0]="MONEY_NOT_ENOUGH",t[t.STORE_NOT_ENOUGH=1]="STORE_NOT_ENOUGH",t[t.BUY_ZERO=2]="BUY_ZERO",t[t.SELL_ZERO=3]="SELL_ZERO",t[t.MARKET_NO_GOOD=4]="MARKET_NO_GOOD",t[t.MAX_STORE_NUM=5]="MAX_STORE_NUM",t[t.NEED_LICIENCE=6]="NEED_LICIENCE"}(ERROR||(ERROR={}));var ACHIVE;!function(t){t[t.RELIVE=1]="RELIVE"}(ACHIVE||(ACHIVE={}));var Int64=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._highValue=0,this._lowValue=0,this.cacheString=new Array,this._lowValue=t,this._highValue=e}return Object.defineProperty(t.prototype,"higherUint",{get:function(){return this._highValue},set:function(t){this._highValue!=t&&(this._highValue=t,this.cacheBytes=null,this.cacheString=[])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lowerUint",{get:function(){return this._lowValue},set:function(t){this._lowValue=t,this._lowValue!=t&&(this.cacheBytes=null,this.cacheString=[])},enumerable:!0,configurable:!0}),t.prototype.fromString=function(t,e){if(void 0===e&&(e=10),!t)return void this.reset();t=t.toLowerCase();for(var a=4294967296,n=0,r=0,i=0;i<t.length;i++){var s=t.charCodeAt(i)-48;s>9&&(s-=39),n=n*e+s,r=r*e+(n/a>>0),n%=a}this._lowValue=n,this._highValue=r,this.cacheString=[],this.cacheString[e]=t,this.cacheBytes=null},t.prototype.fromBytes=function(t,e){void 0===e&&(e=0);try{t.position=e,t.endian==egret.Endian.LITTLE_ENDIAN?(this._lowValue=t.readUnsignedInt(),this._highValue=t.readUnsignedInt()):(this._highValue=t.readUnsignedInt(),this._lowValue=t.readUnsignedInt())}catch(a){return void this.reset()}this.cacheBytes=null,this.cacheString=[]},t.prototype.reset=function(){this._highValue=0,this._lowValue=0,this.cacheBytes=null,this.cacheString=[]},t.prototype.clone=function(){return new t(this._lowValue,this._highValue)},t.prototype.copy=function(t){this.reset(),this._lowValue=t._lowValue,this._highValue=t._highValue},t.prototype.cloneTo=function(e){return null==e&&(e=new t),e.copy(this),e},t.prototype.equals=function(t){return null==t?!1:this._highValue==t._highValue&&this._lowValue==t._lowValue},Object.defineProperty(t.prototype,"bytes",{get:function(){return this.cacheBytes?this.cacheBytes:(this.cacheBytes=new egret.ByteArray,this.cacheBytes.endian=egret.Endian.LITTLE_ENDIAN,this.cacheBytes.writeUnsignedInt(this._lowValue),this.cacheBytes.writeUnsignedInt(this._highValue),this.cacheBytes)},enumerable:!0,configurable:!0}),t.prototype.toNumber=function(){var t=this.toString();return""==t?0:parseInt(t)},t.prototype.toString=function(t){if(void 0===t&&(t=10),2>t||t>36)throw new RangeError("基数参数必须介于 2 到 36 之间；当前值为 "+t+"。");if(this.cacheString[t])return this.cacheString[t];for(var e,a,n,r="",i=this._lowValue,s=this._highValue,o=Math.pow(2,32);0!=s||0!=i;)e=s%t,n=e*o+i,a=n%t,r=a.toString(t)+r,s=(s-e)/t,i=(n-a)/t;return this.cacheString[t]=""==r?"0":r,this.cacheString[t]},t.prototype.parseData=function(t){this._highValue=t.readUnsignedInt(),this._lowValue=t.readUnsignedInt()},t.prototype.toData=function(t){t.writeUnsignedInt(this._highValue),t.writeUnsignedInt(this._lowValue)},t.prototype.gc=function(){this.cacheBytes=null,this.cacheString=null},t}();__reflect(Int64.prototype,"Int64");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var msgGoodsStoreRsp=function(){function t(){this.goods=[]}return t}();__reflect(msgGoodsStoreRsp.prototype,"msgGoodsStoreRsp");var msgLifeDataRsp=function(){function t(){this.dwPow=0,this.dwDebt=0,this.dwTimes=0,this.dwMaxStoreNum=0,this.dwFame=0}return t}();__reflect(msgLifeDataRsp.prototype,"msgLifeDataRsp");var varGoods=function(){function t(){this.dwID=0,this.dwPrice=0,this.dwNum=0}return t}();__reflect(varGoods.prototype,"varGoods");var StringUtil=function(){function t(){}return t.getSwfLangTextFlowVar=function(e,a){return(new egret.HtmlTextParser).parser(t.getSwfLangStrVar(e,a))},t.getSwfLangStrVarByID=function(e,a){if(null==GameLogic.getInstance().strings)return e;var n=GameLogic.getInstance().strings[e];return null==n?e:t.getSwfLangStrVar(n,a)},t.getSwfLangStrVar=function(e,a){var n,r,i;n=e.indexOf("{"),r=e.indexOf("}");for(var s,o,h,c,l=0;-1!=n&&-1!=r;){i=e.substring(n,r+1),s=e.indexOf("@",l);var u=parseInt(e.substring(s+1,e.indexOf(":",s)))-1;if(0/0==u)return"stringError:"+e;o=e.indexOf("!#[",l)+3,o>2&&(h=e.indexOf("]@",l),c=e.substring(o,h),a[u]=t.getSwfLangStr(c+a[u]));var p=a[u].toString();e=e.replace(i,p),l=n+p.length,n=e.indexOf("{",l),r=e.indexOf("}",l)}return e},t.getSwfLangStr=function(t){if(null==GameLogic.getInstance().strings)return t;var e=GameLogic.getInstance().strings[t];return null==e?t:e.toString()},t}();__reflect(StringUtil.prototype,"StringUtil");var GameEvent=function(){function t(){}return t}();__reflect(GameEvent.prototype,"GameEvent");var GameUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="GameSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),GameLogic.getInstance().gameui=this,this.market_arr=[],this.store_arr=[],this.eventlist=[],this.initView(),this.initEvent(),GameCommand.getInstance().startGame()},e.prototype.eventAppear=function(t){return GameLogic.getInstance().cbSelected?void 0:this.eventpoping?void this.eventlist.push(t):void this.popEvent(t)},e.prototype.eventNext=function(){if(this.eventpoping=!1,this.eventlist.length>0){var t=this.eventlist.shift();this.popEvent(t)}else this.pop(0)},e.prototype.popEvent=function(t){"playerdescription"==t?(this.lbl_event_1.height=280,t=StringUtil.getSwfLangStr("s2")):this.lbl_event_1.height=90,this.eventpoping=!0,this.pop(11),this.lbl_event_1.text=t},e.prototype.initData=function(t){this.data=t,this.setLeft(),this.lbl_1.text=this.data.dwMoney.toString(),this.lbl_2.text=this.data.dwDeposit.toString(),this.lbl_3.text=this.data.dwDebt.toString(),this.lbl_4.text=this.data.dwPow.toString(),this.lbl_5.text=this.data.dwFame.toString();var e=GameLogic.getInstance().data.maxday;this.lbl_day.text=e-this.data.dwTimes+"/"+e+"天"},e.prototype.setLeft=function(){var t=this.getStoreNum();this.leftStore=this.data.dwMaxStoreNum-t,this.lbl_store.text=t+"/"+this.data.dwMaxStoreNum},e.prototype.getStoreNum=function(){for(var t=0,e=0;e<this.store_arr.length;e++){var a=this.store_arr[e];t+=a.good.dwNum}return t},e.prototype.initMarket=function(t){this.clearMarket();for(var e=0;e<t.goods.length;e++){var a=new MarketItem(t.goods[e]);a.y=(a.height+2)*e,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickMarketItem,this),this.market_arr.push(a),this.gp_market.addChild(a)}},e.prototype.clickMarketItem=function(t){var e=t.currentTarget;null!=this.crtMarketItem&&(this.crtMarketItem.select=!1),this.crtMarketItem=e,this.crtMarketItem.select=!0,this.pop(9);var a=Math.floor(this.data.dwMoney/e.good.dwPrice);this.max_num=a>this.leftStore?this.leftStore:a,this.lbl_buy_1.text=e.good.strName,this.lbl_num6.text=this.max_num+""},e.prototype.initStore=function(t){this.clearStore();for(var e=0;e<t.goods.length;e++){var a=new StoreItem(t.goods[e]);a.y=(a.height+2)*e,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickStoreItem,this),this.store_arr.push(a),this.gp_store.addChild(a)}this.setLeft()},e.prototype.clickStoreItem=function(t){var e=t.currentTarget;null!=this.crtStoreItem&&(this.crtStoreItem.select=!1),this.crtStoreItem=e,this.crtStoreItem.select=!0,this.pop(10),this.max_num=this.crtStoreItem.good.dwNum,this.lbl_sell_1.text=e.good.strName,this.lbl_num7.text=this.max_num+""},e.prototype.storeUp=function(t){},e.prototype.over=function(){this.gp_over.visible=!0;var t="";if(this.data.dwPow<=0)t+=StringUtil.getSwfLangStr("s20")+"\n",this.btn_27.visible=!1;else{t+=StringUtil.getSwfLangStr("s11")+"\n",t+=StringUtil.getSwfLangStrVarByID("s21",[DataBase.money+""])+"\n",t+=StringUtil.getSwfLangStr("s12")+"\n";for(var e=0;5>e;e++)t+=StringUtil.getSwfLangStrVarByID("s1"+(3+e),[DataBase.achives[e]+""])+"\n";t+=StringUtil.getSwfLangStr("s19")+"\n",t+=StringUtil.getSwfLangStr("s50")+"\n",this.btn_27.visible=!0}this.lbl_over_1.text=t},e.prototype.errorRsp=function(t){this.eventAppear(StringUtil.getSwfLangStr("e"+t))},e.prototype.initView=function(){this.cb_0.selected=GameLogic.getInstance().cbSelected},e.prototype.initEvent=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.clear,this);for(var t=0;27>=t;t++){var e=this["btn_"+t];e.name=t+"",e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)}for(var t=0;7>=t;t++){var a=this["lbl_num"+t];a.name="lbl"+t,a.addEventListener(egret.Event.CHANGE,this.txtChange,this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.txtClick,this)}this.cb_0.addEventListener(egret.Event.CHANGE,this.cbChange,this),this.rect_evt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickRect,this)},e.prototype.cbChange=function(){GameLogic.getInstance().cbSelected=this.cb_0.selected},e.prototype.clickRect=function(t){this.eventNext()},e.prototype.txtClick=function(t){var e=t.currentTarget,a=parseInt(e.name.slice(3));switch(a){case 1:this.max_num=this.data.dwMoney;break;case 2:this.max_num=this.data.dwDeposit}},e.prototype.txtChange=function(t){var e=t.currentTarget,a=parseInt(e.text);a>this.max_num&&(e.text=this.max_num+"")},e.prototype.clickBtn=function(t){var e=parseInt(t.currentTarget.name);if(!(0==this.gamestate&&9>e&&e>12&&26>e))switch(e){case 0:this.pop(0),GameCommand.getInstance().charity(parseInt(this.lbl_num0.text));break;case 1:case 2:case 3:this.pop(0),GameCommand.getInstance().passOneDay();break;case 4:this.pop(e),this.max_num=this.data.dwMoney,this.lbl_charity.text=StringUtil.getSwfLangStr("s10"),this.lbl_num0.text="0";break;case 5:this.pop(e),this.lbl_num1.text=this.data.dwMoney+"",this.lbl_num2.text=this.data.dwDeposit+"";break;case 6:this.pop(e);var a=100-this.data.dwPow;0>=a?(this.lbl_hos_1.text=StringUtil.getSwfLangStr("s6"),this.max_num=0):(this.lbl_hos_1.text=StringUtil.getSwfLangStrVarByID("s7",[GameLogic.getInstance().data.hospital+""]),this.max_num=a),this.lbl_num3.text=this.max_num+"";break;case 7:this.pop(e);var n=GameLogic.getInstance().data.maxstore-this.data.dwMaxStoreNum;if(0>=n)this.lbl_medi_1.text=StringUtil.getSwfLangStr("s8");else{var r=GameLogic.getInstance().data.storeprice,i=Math.floor(Math.random()*r/5)+r;this.lbl_medi_1.text=StringUtil.getSwfLangStrVarByID("s9",[i+""])}break;case 8:this.pop(e);var s=this.data.dwDebt,o=this.data.dwMoney>s?s:this.data.dwMoney;0>=s?(this.lbl_post_1.text=StringUtil.getSwfLangStr("s102"),this.max_num=0):(this.lbl_post_1.text=StringUtil.getSwfLangStr("s101"),this.max_num=o),this.lbl_num5.text=this.max_num+"";break;case 9:GameLogic.getInstance().share();break;case 10:this.popEvent("playerdescription");break;case 11:GameLogic.getInstance().openRank();break;case 12:case 26:this.restart();break;case 13:GameCommand.getInstance().cun(parseInt(this.lbl_num1.text)),this.pop(0);break;case 14:GameCommand.getInstance().qu(parseInt(this.lbl_num2.text)),this.pop(0);break;case 15:this.data.dwPow<100&&GameCommand.getInstance().treat(100-this.data.dwPow),this.pop(0);break;case 17:var h=GameLogic.getInstance().data.storeprice;h=Math.floor(Math.random()*h/5)+h,GameCommand.getInstance().buyStore(h),this.pop(0);break;case 19:var c=parseInt(this.lbl_num5.text);c=this.data.dwMoney<c?this.data.dwMoney:c,GameCommand.getInstance().huan(c),this.pop(0);break;case 21:var l=parseInt(this.lbl_num6.text);l>0&&GameCommand.getInstance().buyGoods(this.crtMarketItem.good.dwID,l),this.pop(0);break;case 23:var u=parseInt(this.lbl_num7.text);u>0&&GameCommand.getInstance().sellGoods(this.crtStoreItem.good.dwID,u),this.pop(0);break;case 16:case 18:case 20:case 22:case 24:this.pop(0);break;case 25:this.eventNext();break;case 27:}},e.prototype.pop=function(t){if(null!=this.crtPop){var e=this["gp_"+this.crtPop];null!=e&&(e.visible=!1)}0==t&&(this.eventpoping=!1);var a=this["gp_"+t];null!=a?(a.visible=!0,this.crtPop=t):this.crtPop=null},e.prototype.clearMarket=function(){for(var t=0;t<this.market_arr.length;t++){this.market_arr[t]}this.gp_market.removeChildren(),this.market_arr=[],this.crtMarketItem=null},e.prototype.clearStore=function(){for(var t=0;t<this.store_arr.length;t++){var e=this.store_arr[t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickStoreItem,this)}this.gp_store.removeChildren(),this.store_arr=[],this.crtStoreItem=null},e.prototype.restart=function(){GameLogic.getInstance().startGame()},e.prototype.clear=function(){this.clearEvent(),this.clearMarket(),this.clearStore(),GameLogic.getInstance().gameui=null},e.prototype.clearEvent=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.clear,this);for(var t=0;27>=t;t++){var e=this["btn_"+t];e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)}for(var t=0;7>=t;t++){var a=this["lbl_num"+t];a.removeEventListener(egret.Event.CHANGE,this.txtChange,this),a.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.txtClick,this)}this.cb_0.removeEventListener(egret.Event.CHANGE,this.cbChange,this),this.rect_evt.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickRect,this)},e}(eui.Component);__reflect(GameUI.prototype,"GameUI");var MarketItem=function(t){function e(e){var a=t.call(this)||this;return a.good=e,a.skinName="MarketItemSkin",a}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lbl_name.text=this.good.strName,this.lbl_price.text=this.good.dwPrice+""
},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.rect_bg.fillAlpha=t?1:0},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.good=null},e}(eui.Component);__reflect(MarketItem.prototype,"MarketItem");var StartUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="StartSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=GameLogic.getInstance().data;this.lbl_name.text=StringUtil.getSwfLangStr("s1"),this.lbl_content.text=StringUtil.getSwfLangStr("s2");for(var a=1;3>=a;a++){var n=e["config"+a],r=1==a?"开始游戏":n.rmb+"元  开始";3==a&&(r+="(可获炒房证)");var i=this["btn_"+a];i.label=r,i.name=a+"",i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)}this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.clear,this)},e.prototype.clickBtn=function(t){if(null==GameLogic.getInstance().strings)return void(this.lbl_log.text="正在形成市场，请稍后...");var e=parseInt(t.currentTarget.name);GameCommand.getInstance().selectPackage(e),GameLogic.getInstance().startGame()},e.prototype.clear=function(){for(var t=1;3>=t;t++)this["btn_"+t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this);this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.clear,this)},e}(eui.Component);__reflect(StartUI.prototype,"StartUI");var StoreItem=function(t){function e(e){var a=t.call(this)||this;return a.good=e,a.skinName="StoreItemSkin",a}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.update()},e.prototype.updateGood=function(t){this.good=t,this.update()},e.prototype.update=function(){this.lbl_name.text=this.good.strName,this.lbl_price.text=this.good.dwPrice+"",this.lbl_num.text=this.good.dwNum+""},Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){this._select=t,this.rect_bg.fillAlpha=t?1:0},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.good=null},e}(eui.Component);__reflect(StoreItem.prototype,"StoreItem"),window.Main=Main;